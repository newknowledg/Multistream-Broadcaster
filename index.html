<!doctype html>

<html lang=en>
    <head>
    <meta charset="utf-8"/>
       <title>Restream</title>
    </head>
    <body>
    <button id="addS">Add Stream</button>
    <div id="app">
        <div class="kInput">
          <select class="dest">
            <option value="yt">YouTube</option>
            <option value="fb">Facebook</option>
          </select><br>
          <label>Enter Stream Key</label>
            <input type="text" class="s_key">
        </div>
        <div class="kInput">
          <select class="dest">
            <option value="yt">YouTube</option>
            <option value="fb">Facebook</option>
          </select><br>
            <label>Enter Stream Key</label> 
            <input type="text" class="s_key">
        </div>
    </div>
    <button id="inject">submit</button>
    <template id="tempd">
        <div class="kInput">
          <select class="dest">
            <option value="yt">YouTube</option>
            <option value="fb">Facebook</option>
          </select><br> 
          <label>Enter Stream Key</label>
            <input type="text" class="s_key">
            <button class="delButt">x</button>
        </div>
    </template>
    
    <script>

    const fBook = 'push rtmp://127.0.0.1:1936/rtmp/'
    const yTube = 'push rtmp://a.rtmp.youtube.com/live2/'

    function emit(){
        var tskey = document.getElementsByClassName("s_key");
            tdest = document.getElementsByClassName("dest");
        var skey = []
            fdest = []
        for (var i = 0; i < tskey.length; i++){
               if (tdest[i].value == 'fb'){
                skey.push(fBook);}
               else{
                   skey.push(yTube);
               }
               skey.push(tskey[i].value);
        }; 
         fetch('http://127.0.0.1:4000/test', { method: 'POST', headers: {'content-type':'application/json'}, body: JSON.stringify(skey)})
        // console.log(fdest)
         console.log(skey)
        // console.log(tdest[0].value)
    }
        function addLoc(){
                var temp = document.getElementById("tempd").content;
                var copy = document.importNode(temp,true);
                document.getElementById("app").appendChild(copy);
        }
        function delLine(e){
                if(e.target.classList.contains("delButt")){
                        e.target.parentElement.remove();
                }
        }

    document.getElementById("inject").addEventListener("click", emit);
    document.getElementById("addS").addEventListener("click", addLoc);
    document.getElementById("app").addEventListener("click", delLine);
    </script>
    </body>
</html>

